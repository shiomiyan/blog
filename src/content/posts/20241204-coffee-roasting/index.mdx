---
title: ã‚³ãƒ¼ãƒ’ãƒ¼è±†ã®ç„™ç…æ¸©åº¦ã‚’è¨ˆæ¸¬ã—ã¦ã¿ãŸ
date: "2024-12-04"
description: ""
ulid: 01JE7FEV00Z816DJYP48CZDPMF
tags:
  - raspberry-pi
---
import { Image, Picture } from "astro:assets";
import img_20241121_222830 from "./20241121_222830.jpg";
import img_20241121_222851 from "./20241121_222851.jpg";
import img_fritzing from "./fritzing.png";

[Raspberry Pi Advent Calendar 2024](https://adventar.org/calendars/10003)ã®4æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

ã‚³ãƒ¼ãƒ’ãƒ¼è±†ã®æ‰‹é‹ç„™ç…ã«ãƒãƒã£ã¦ãŠã‚Šã€å®‰å®šã—ãŸç„™ç…ã‚’ã™ã‚‹ãŸã‚ã«ï¼ˆï¼Ÿï¼‰ç„™ç…æ¸©åº¦ã‚’è¨ˆæ¸¬ã—ãŸããªã£ãŸã®ã§ã€ã‚„ã£ã¦ã¿ã¾ã—ãŸã€‚

<Image src={img_20241121_222830} alt="ç„™ç…ã™ã‚‹ç›´å‰ã®æ§˜å­" class="w-auto h-[400px] object-contain" />

ã¨ã„ã£ã¦ã‚‚[CircuitPythonãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¿ãŸã„ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://learn.adafruit.com/circuitpython-on-raspberrypi-linux/spi-sensors-devices)ã‚’ãªãã£ã¦ã„ãã ã‘ã§ã™ã€‚

## æº–å‚™ã—ãŸã‚‚ã®

- [Raspberry Pi 4 Model B (RAM 4G)](https://www.switch-science.com/products/6030)
    - ã‚ªãƒ¼ãƒãƒ¼ã‚¹ãƒšãƒƒã‚¯ã§ã—ã‹ãªã„ã§ã™ãŒã€ã„ã¤ã‹å½¹ã«ç«‹ã¤ã¨æ€ã£ã¦...
- ãƒ–ãƒ¬ãƒƒãƒ‰ãƒœãƒ¼ãƒ‰ãƒ»ã‚¸ãƒ£ãƒ³ãƒ‘ãƒ¯ã‚¤ãƒ¤
- [Kå‹ç†±é›»å¯¾ã‚¢ãƒ³ãƒ—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆMAX31855ï¼‰](https://akizukidenshi.com/catalog/g/g108218/)
- [Kå‹ç†±é›»å¯¾ãƒ—ãƒ­ãƒ¼ãƒ–](https://www.switch-science.com/products/2976)
- ã¯ã‚“ã ã€ã¯ã‚“ã ã‚´ãƒ†

ä¸€é€šã‚Šå¿…è¦ãã†ãªã‚‚ã®ã¯ã‚¹ã‚¤ãƒƒãƒã‚µã‚¤ã‚¨ãƒ³ã‚¹ã§æƒãˆã¤ã¤ã€ä½œæ¥­ã—ã¦ã„ã¦å¿…è¦ã«ãªã£ãŸã‚‚ã®ã¯ç§‹æœˆé›»å­ã«è²·ã„ã«è¡Œãã¾ã—ãŸï¼ˆè‰²ã€…é–“é•ãˆã¦æ—¥ã«2åº¦ã‚‚ç§‹æœˆé›»å­ã«è¶³ã‚’é‹ã¶ã“ã¨ã«ãªã‚Šã¾ã—ãŸï¼‰ã€‚

## ãƒ©ã‚ºãƒ‘ã‚¤ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

SSHã€SPI moduleã€I2C moduleã‚’æœ‰åŠ¹åŒ–ã—ã¦ãŠãã¾ã™ã€‚

```shell
sudo raspi-config

# Interface Options -> SSH / SPI / I2C
```

## è‰²ã€…ç¹‹ã

ãƒ©ã‚ºãƒ‘ã‚¤ã®GPIOãƒ”ãƒ³ã«ãƒ–ãƒ¬ãƒƒãƒ‰ãƒœãƒ¼ãƒ‰çµŒç”±ã§ç†±é›»å¯¾ã‚¢ãƒ³ãƒ—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’æ¥ç¶šã—ã¾ã™ã€‚

[ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®é…ç·šå›³](https://learn.adafruit.com/circuitpython-on-raspberrypi-linux/spi-sensors-devices#wiring-2993466)é€šã‚Šã«ç¹‹ã„ã§ã„ãã ã‘ã§ã™ã€‚

<Image src={img_fritzing} alt="adafruitã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ç”¨ã„ã‚‰ã‚Œã¦ã„ã‚‹é…ç·šå›³" class="w-auto h-[400px] object-contain" />

ã¨ã„ã†ã‚ã‘ã§ã€ã¤ãªãã¾ã—ãŸã€‚

<Image src={img_20241121_222851} alt="ãƒ©ã‚ºãƒ‘ã‚¤ã«MAX31855ã‚’æ¥ç¶šã—ãŸæ§˜å­" class="w-auto h-[400px] object-contain" />

## è¨ˆæ¸¬ã™ã‚‹

MAX31855ã‚’åˆ©ç”¨ã™ã‚‹ã†ãˆã§å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯`pip`ã§å°å…¥ã§ãã¾ã™ãŒã€[ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã‚ˆã†ã¨ã™ã‚‹ã¨æ€’ã‚‰ã‚Œã‚‹](https://zenn.dev/tanny/articles/ce010edd69d56a)ã®ã§ã€ä»®æƒ³ç’°å¢ƒã‚’ä½¿ã„ã¾ã™ã€‚  
ã¾ãŸã€globalã«å…¥ã£ã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆ`board`ã¨ã‹ï¼‰ã‚’ä»®æƒ³ç’°å¢ƒå†…ã‹ã‚‰å‚ç…§ã™ã‚‹ãŸã‚ã«ã€`--system-site-package`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¾ã™ã€‚

```shell
python -m venv .venv --system-site-package
source .venv/bin/activate
pip3 install adafruit-circuitpython-max31855
```

ã‚ã¨ã¯å¼•ãç¶šããƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã«å¾“ã†ã ã‘ã§ã™ãŒã€å¾Œã§æ¸©åº¦å¤‰åŒ–ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«CSVã§ãã‚Œã‚‰ã—ã„ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚

```python
# SPDX-FileCopyrightText: 2021 ladyada for Adafruit Industries
# SPDX-License-Identifier: MIT

import time
import board
import digitalio
import adafruit_max31855


def main():
    spi = board.SPI()
    cs = digitalio.DigitalInOut(board.D5)
    max31855 = adafruit_max31855.MAX31855(spi, cs)

    start = time.time()
    data = []
    try:
        while True:
            try:
                tempC = max31855.temperature
            except RuntimeError:
                # Ignore `short circuit to ground` error ğŸ”¥
                pass
            else:
                now = time.time()
                data.append([now, tempC])
                print(f"Temperature: {tempC} C")
                print(
                    f"Elapsed: {int(now - start) // 60} min {int(now - start) % 60} sec"
                )
                time.sleep(1.0)

    except KeyboardInterrupt:
        import csv

        filename = f"data/roasting_{int(time.time())}.csv"
        with open(filename, mode="w", encoding="utf-8") as file:
            writer = csv.writer(file)
            writer.writerows(data)


if __name__ == "__main__":
    main()
```

ä½•åº¦ã‹ãƒ†ã‚¹ãƒˆã—ã¦ã„ã‚‹ã¨`RuntimeError: short circuit to ground`ãŒé »ç™ºã™ã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã§ã€æ¡ã‚Šã¤ã¶ã—ã¾ã—ãŸã€‚  
ãƒ‡ãƒã‚¤ã‚¹ã«ã¯ã‚ã¾ã‚Šè‰¯ããªã•ãã†ã§ã™ãŒã€äººãŒæ­»ã¬ã‚ã‘ã§ã¯ãªã„ã®ã§...

## çµæœã‚’ã‚°ãƒ©ãƒ•ã«å‡ºåŠ›ã™ã‚‹

Jupyterç’°å¢ƒã‚’ç”¨æ„ã—ã¦ã‚°ãƒ©ãƒ•ã«ã—ã¾ã™ã€‚Jupyterã˜ã‚ƒãªãã¦ã‚‚ã„ã„ã®ã§ã™ãŒã€å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªç¾¤ãŒã‚µã‚¯ãƒƒã¨æƒã£ã¦æ¥½ãªã®ã§ã€‚

è³¼å…¥ã—ãŸRaspberry Piã¯ãƒ¡ãƒ¢ãƒªãŒ4GBã‚‚ã‚ã‚‹ã®ã§ã€arm64ã®OSã‚’ä½¿ãˆã°DockerãŒæ™®é€šã«å‹•ãã¾ã™ã€‚é©å½“ã«composeãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¦Jupyter Notebookã‚’ç«‹ã¡ä¸Šã’ã¾ã™ã€‚

```yaml
services:
  jupyter:
    image: quay.io/jupyter/scipy-notebook:2024-10-07
    ports:
      - 10000:10000
    command:
      - start-notebook.sh
      - --NotebookApp.token=''
      - --NotebookApp.disable_check_xsrf=True
    environment:
      - JUPYTER_PORT=10000
    volumes:
      - ./jupyter:/home/jovyan/work
      - ./data:/home/jovyan/data
```

ã§ã€ã‚ˆã—ãªã«å¯è¦–åŒ–ã—ã¦ã¿ã‚‹ã¨ã€ã“ã‚“ãªæ„Ÿã˜ã§ã—ãŸã€‚

![å¯è¦–åŒ–ã—ã¦ã¿ãŸ](./graph.png)

10åˆ†ä»˜è¿‘ã«ã‚ã‚‹æ¸©åº¦å¤‰åŒ–ã¯ã€ã‚«ã‚»ãƒƒãƒˆã‚³ãƒ³ãƒ­ã®ã‚¬ã‚¹ãŒåˆ‡ã‚Œã¦ã—ã¾ã£ãŸã“ã¨ã«ã‚ˆã‚‹ã‚‚ã®ã§ã™ğŸ˜¢  
ãŠã‹ã’ã§ç„™ç…æ™‚é–“ãŒã‚ã¡ã‚ƒã‚ã¡ã‚ƒä¼¸ã³ã¦ã—ã¾ã„ã¾ã—ãŸã€‚

## æ„Ÿæƒ³ãªã©

- æµçŸ³ã«å›ºå®šæ–¹æ³•ãŒç”˜ãï¼ˆãƒ†ãƒ¼ãƒ—ã§è“‹ã®ç©´ã«å›ºå®šã—ã¦ã„ã‚‹ã ã‘ï¼‰ã€è¨ˆæ¸¬ãƒã‚¤ã‚ºãŒé…·ã‹ã£ãŸ
  - è£½å“ã®ä¿¡é ¼æ€§ã¿ãŸã„ãªã¨ã“ã‚ã¯ã‚ã‹ã‚‰ãªã„ã§ã™ãŒã€[å›ºå®šã—ã‚„ã™ãã†ãªç†±é›»å¯¾ã‚‚å£²ã£ã¦ã„ã‚‹](https://www.amazon.co.jp/dp/B00FVREP12)ã®ã§ã€ã“ã‚Œã‚’è²·ã£ã¦é‹ã«å›ºå®šã—ã¦ã‚‚ã„ã„ã‹ã‚‚ã—ã‚Œãªã„
    - [ã“ã‚“ãªæ„Ÿã˜](https://youtu.be/9vaDTce4eK4)
- [artisan](https://artisan-scope.org/)ã¨ã„ã†ç„™ç…å°‚ç”¨ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹å¯è¦–åŒ–ãƒ„ãƒ¼ãƒ«ãŒã‚ã‚‹ã¿ãŸã„ãªã®ã§ã€ãã£ã¡ã‚’ä½¿ã†ã§ã‚‚è‰¯ã‹ã£ãŸã‹ã‚‚ï¼ˆå¯¾å¿œã—ã¦ã„ã‚‹ãƒ­ã‚¬ãƒ¼ã«åˆ¶é™ã¯ã‚ã‚‹ã£ã½ã„ï¼‰
- æ™®é€šã«èµ¤å­—
