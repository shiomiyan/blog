{{ partial "header" . }}
{{ partial "nav" . }}
<section class="section">
  <div class="container">
    {{- $pages := . -}}
    {{- if .IsHome -}}
    {{- $pages = .Site.RegularPages -}}
    {{- else -}}
    {{ $pages = .Pages -}}
    {{- end -}}

    {{ $rss := getJSON "data/rss.json" }}

    {{ $allEntries := slice }}

    {{ range $rss }}
    {{ $allEntries = $allEntries | append (dict "title" .title "link" .link "pubDate" (.pubDate | time.AsTime) "type"
    "rss") }}
    {{ end }}

    {{ range $pages }}
    {{ if not .Params.hidden }}
    {{ $allEntries = $allEntries | append (dict "title" .Title "link" .Permalink "pubDate" (.Date) "type" "hugo") }}
    {{ end }}
    {{ end }}

    {{ $uniqueEntries := slice }}

    {{ range $allEntries }}
    {{ $isDuplicate := false }}
    {{ $currentLink := .link }}
    {{ range $uniqueEntries }}
    {{ if eq .link $currentLink }}
    {{ $isDuplicate = true }}
    {{ break }}
    {{ end }}
    {{ end }}
    {{ if not $isDuplicate }}
    {{ $uniqueEntries = $uniqueEntries | append . }}
    {{ end }}
    {{ end }}

    {{ $sortedEntries := sort $uniqueEntries "pubDate" "desc" }}

    {{ range $sortedEntries }}
    <article>
      <h1 class="title is-list">
        <a href="{{ .link }}" {{ if ne .type "hugo" }} target="_blank" rel="noreferrer" {{ end }}>
          {{ .title }}
          {{ if eq .type "hugo" }}
          {{ partial "taxonomies_count" . }}
          {{ if .Draft }}::Draft{{ end }}
          {{ end }}
        </a>
      </h1>
      <h2 class="subtitle is-6 date">
        {{ if eq .type "hugo" }}
        {{ .pubDate.Format "January 2, 2006" }}
        {{ if .Params.categories }}
        {{ partial "categories" .Params.categories }}
        {{ end }}
        {{ else }}
        {{ .pubDate | time.Format ":date_medium" }}
        {{ if strings.HasPrefix .link "https://qiita.com" }}
        * from qiita.com
        {{ end }}
        {{ end }}
      </h2>
    </article>
    {{ end }}
  </div>
</section>
{{ partial "pager" . }}
{{ partial "footer" . }}